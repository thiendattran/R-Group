mypalette_1 <- brewer.pal(8,"YlOrBr")
ggplot(bd, aes(x = f.1180.0.0, fill = f.1180.0.0)) +
geom_bar(colour = "grey") +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,100000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20)) +
guides(fill = F) +
scale_fill_manual(values = c("#D3D3D3","#E5E5E5","#FFE5B4", "#FFFFC2", "#A7C9FF", "#5B7E91", "#D3D3D3"))
bd <- mutate (bd, chronotype = case_when (f.1180.0.0 %in% c("Definitely a 'morning' person","More a 'morning' than 'evening' person") ~ "Morning type",
f.1180.0.0 %in% c("Definitely an 'evening' person","More an 'evening' than a 'morning' person") ~ "Evening type",
f.1180.0.0 == "Prefer not to answer" ~ NA,
f.1180.0.0 == "Do not know" ~ "Do not know")
)
ggplot(bd, aes(x = chronotype, fill = chronotype)) +
geom_bar() +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,200000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20))+
scale_fill_manual(values = c("#E5E5E5","#5B7E91","#FFFFC2", "#D3D3D3"))
frequency_tab <- bd %>% select(c(night_shift, f.31.0.0, f.21003.0.0, f.21000.0.0, f.22006.0.0, f.816.0.0, f.767.0.0, f.22605.0.0, f.757.0.0, f.6138.0.0, f.21002.0.0, f.50.0.0, f.21001.0.0, f.189.0.0, f.20160.0.0, f.1239.0.0, f.2887.0.0, f.3456.0.0 , f.22040.0.0, f.20117.0.0, f.1558.0.0, f.1180.0.0, chronotype, f.1200.0.0, f.20517.0.0, f.1160.0.0, f.6153.0.0, f.6177.0.0)) %>%
tbl_summary(by = night_shift,
statistic = list(all_continuous() ~ "{mean} ({sd})", all_categorical() ~ "{n} ({p}%)"),
digits = list(all_continuous() ~ c(2,2), all_categorical() ~ c (0,2)),
label = c (f.31.0.0 ~ "Sex",
f.21003.0.0 ~ "Age when attended assessment centre (Year)",
f.21000.0.0 ~ "Ethnic background",
f.22006.0.0 ~ "Genetic ethnicity",
f.816.0.0 ~ "Job involves heavy manual",
f.767.0.0 ~ "Length of working week for main job",
f.22605.0.0 ~ "Work hour per week",
f.757.0.0 ~ "Time employed in main current job",
f.6138.0.0 ~ "Qualification",
f.21002.0.0 ~ "Weight (kg)",
f.50.0.0 ~ "Height (cm)",
f.21001.0.0 ~ "BMI (kg/m2)",
f.189.0.0 ~ "Townsend Index",
f.20160.0.0 ~ "Ever smoked",
f.1239.0.0 ~ "Current tobacco smoking",
f.2887.0.0 ~ "Number of cigarettes previously smoked daily",
f.3456.0.0 ~ "Number of cigarette currently smoked daily",
f.22040.0.0 ~ "Physical activity (summed MET/week)",
f.20117.0.0 ~ "Alcohol drinker",
f.1558.0.0 ~ "Alcohol intake frequency",
f.1180.0.0 ~ "Chronotype",
chronotype ~ "Chronotype - 3 levels",
f.1200.0.0 ~ "Insomnia",
f.20517.0.0 ~ "Trouble falling asleep",
f.1160.0.0 ~ "Sleep duration",
f.6153.0.0 ~ "Medication usage",
f.6177.0.0 ~ "Medication for cholesterol, bp, diabetes")
#,missing = "no"
) %>%
add_n() %>%
add_p(test  = list (all_categorical() ~ "chisq.test")) %>%
bold_labels() %>%
add_overall()
frequency_tab
frequency_tab %>% as_tibble() %>% writexl::write_xlsx(path = "Results/frequency_tab.xlsx")
frequency_tab %>% as_flex_table() %>% flextable::save_as_docx(path = "Results/frequency_tab.docx")
options(scipen = 10000)
mypalette_1 <- brewer.pal(8,"YlOrBr")
ggplot(bd, aes(x = f.1180.0.0, fill = f.1180.0.0)) +
geom_bar(colour = "grey") +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,100000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20)) +
guides(fill = F) +
scale_fill_manual(values = c("#D3D3D3","#E5E5E5","#FFE5B4", "#FFFFC2", "#C5D9FF", "#5B7E91", "#D3D3D3"))
bd <- mutate (bd, chronotype = case_when (f.1180.0.0 %in% c("Definitely a 'morning' person","More a 'morning' than 'evening' person") ~ "Morning type",
f.1180.0.0 %in% c("Definitely an 'evening' person","More an 'evening' than a 'morning' person") ~ "Evening type",
f.1180.0.0 == "Prefer not to answer" ~ NA,
f.1180.0.0 == "Do not know" ~ "Do not know")
)
ggplot(bd, aes(x = chronotype, fill = chronotype)) +
geom_bar() +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,200000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20))+
scale_fill_manual(values = c("#E5E5E5","#5B7E91","#FFE5B4", "#D3D3D3"))
bd <- mutate (bd, chronotype = case_when (f.1180.0.0 %in% c("Definitely a 'morning' person","More a 'morning' than 'evening' person") ~ "Morning type",
f.1180.0.0 %in% c("Definitely an 'evening' person","More an 'evening' than a 'morning' person") ~ "Evening type",
f.1180.0.0 == "Prefer not to answer" ~ NA,
f.1180.0.0 == "Do not know" ~ "Do not know")
)
ggplot(bd, aes(x = chronotype, fill = chronotype)) +
geom_bar() +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,200000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20))+
scale_fill_manual(values = c("#E5E5E5","#5B7E91","#FFE5B4", "White"))
ggplot(bd, aes(x = chronotype, fill = chronotype)) +
geom_bar() +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,200000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20))+
scale_fill_manual(values = c("#E5E5E5","#5B7E91","#FFE5B4", "#D3D3D3")) +
guides(fill = F)
frequency_tab <- bd %>% select(c(night_shift, f.31.0.0, f.21003.0.0, f.21000.0.0, f.22006.0.0, f.816.0.0, f.767.0.0, f.22605.0.0, f.757.0.0, f.6138.0.0, f.21002.0.0, f.50.0.0, f.21001.0.0, f.189.0.0, f.20160.0.0, f.1239.0.0, f.2887.0.0, f.3456.0.0 , f.22040.0.0, f.20117.0.0, f.1558.0.0, f.1180.0.0, chronotype, f.1200.0.0, f.20517.0.0, f.1160.0.0, f.6153.0.0, f.6177.0.0)) %>%
tbl_summary(by = night_shift,
statistic = list(all_continuous() ~ "{mean} ({sd})", all_categorical() ~ "{n} ({p}%)"),
digits = list(all_continuous() ~ c(2,2), all_categorical() ~ c (0,2)),
label = c (f.31.0.0 ~ "Sex",
f.21003.0.0 ~ "Age when attended assessment centre (Year)",
f.21000.0.0 ~ "Ethnic background",
f.22006.0.0 ~ "Genetic ethnicity",
f.816.0.0 ~ "Job involves heavy manual",
f.767.0.0 ~ "Length of working week for main job",
f.22605.0.0 ~ "Work hour per week",
f.757.0.0 ~ "Time employed in main current job",
f.6138.0.0 ~ "Qualification",
f.21002.0.0 ~ "Weight (kg)",
f.50.0.0 ~ "Height (cm)",
f.21001.0.0 ~ "BMI (kg/m2)",
f.189.0.0 ~ "Townsend Index",
f.20160.0.0 ~ "Ever smoked",
f.1239.0.0 ~ "Current tobacco smoking",
f.2887.0.0 ~ "Number of cigarettes previously smoked daily",
f.3456.0.0 ~ "Number of cigarette currently smoked daily",
f.22040.0.0 ~ "Physical activity (summed MET/week)",
f.20117.0.0 ~ "Alcohol drinker",
f.1558.0.0 ~ "Alcohol intake frequency",
f.1180.0.0 ~ "Chronotype",
chronotype ~ "Chronotype - 3 levels",
f.1200.0.0 ~ "Insomnia",
f.20517.0.0 ~ "Trouble falling asleep",
f.1160.0.0 ~ "Sleep duration",
f.6153.0.0 ~ "Medication usage",
f.6177.0.0 ~ "Medication for cholesterol, bp, diabetes")
#,missing = "no"
) %>%
add_n() %>%
add_p(test  = list (all_categorical() ~ "chisq.test")) %>%
bold_labels() %>%
add_overall()
frequency_tab
selected_variable <- c("f.eid", #Participant identifier
"f.31.0.0", #Sex
"f.21000.0.0", # Ethnic background
"f.22006.0.0", # Genetic ethnic background
"f.189.0.0", # Townsend deprivation index
"f.826.0.0", # Job involve shift work
"f.3426.0.0", # Job involve nightshirt
"f.816.0.0", # Job involves heavy manual or physical work
"f.767.0.0", # Length of working week for main job
"f.22605.0.0", # Work hours per week
"f.757.0.0", # Time employed in main current job
"f.6138.0.0", # Qualifications
"f.21002.0.0","f.50.0.0","f.21001.0.0", # Weight, heights, BMI
"f.34.0.0", # Year of birth
"f.21003.0.0", # Age at recruitment
"f.20160.0.0", # Ever smoking status
"f.2887.0.0", #Number of cigarettes previously smoked daily
"f.3456.0.0", #Number of cigarette currently smoked daily
"f.1239.0.0", # Current tobacco smoking
"f.22040.0.0", # Summed MET minutes per week for all activity
"f.20117.0.0", # Alcohol drinker status
"f.1558.0.0", # Alcohol intake frequency
"f.1180.0.0", # Chronotype
"f.1160.0.0", # Sleep duration
"f.1200.0.0", # Sleeplessness, insomnia
"f.20517.0.0", # Trouble falling asleep
"f.6142.0.0", # Employment status
"f.6153.0.0", # Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones
"f.6177.0.0" # Medication for cholesterol, blood pressure or diabetes
"f.2976.0.0", "f.2976.1.0", "f.2976.2.0", #Age diabetes diagnosed
selected_variable <- c("f.eid", #Participant identifier
"f.31.0.0", #Sex
"f.21000.0.0", # Ethnic background
"f.22006.0.0", # Genetic ethnic background
"f.189.0.0", # Townsend deprivation index
"f.826.0.0", # Job involve shift work
"f.3426.0.0", # Job involve nightshirt
"f.816.0.0", # Job involves heavy manual or physical work
"f.767.0.0", # Length of working week for main job
"f.22605.0.0", # Work hours per week
"f.757.0.0", # Time employed in main current job
"f.6138.0.0", # Qualifications
"f.21002.0.0","f.50.0.0","f.21001.0.0", # Weight, heights, BMI
"f.34.0.0", # Year of birth
"f.21003.0.0", # Age at recruitment
"f.20160.0.0", # Ever smoking status
"f.2887.0.0", #Number of cigarettes previously smoked daily
"f.3456.0.0", #Number of cigarette currently smoked daily
"f.1239.0.0", # Current tobacco smoking
"f.22040.0.0", # Summed MET minutes per week for all activity
"f.20117.0.0", # Alcohol drinker status
"f.1558.0.0", # Alcohol intake frequency
"f.1180.0.0", # Chronotype
"f.1160.0.0", # Sleep duration
"f.1200.0.0", # Sleeplessness, insomnia
"f.20517.0.0", # Trouble falling asleep
"f.6142.0.0", # Employment status
"f.6153.0.0", # Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones
"f.6177.0.0", # Medication for cholesterol, blood pressure or diabetes
"f.2976.0.0", "f.2976.1.0", "f.2976.2.0", #Age diabetes diagnosed
"f.2443.0.0", "f.2443.1.0", "f.2443.2.0", #Diabetes diagnosed by doctor
"f.2453.0.0", "f.2453.1.0", "f.2453.2.0", #Cancer diagnosed by doctor
#"f.2724.0.0","f.2734.0.0","f.2754.0.0", "f.2784.0.0" # menopause, number of live birth, age at first live birth, oral conceptive
)
selected_variable <- c("f.eid", #Participant identifier
"f.31.0.0", #Sex
"f.21000.0.0", # Ethnic background
"f.22006.0.0", # Genetic ethnic background
"f.189.0.0", # Townsend deprivation index
"f.826.0.0", # Job involve shift work
"f.3426.0.0", # Job involve nightshirt
"f.816.0.0", # Job involves heavy manual or physical work
"f.767.0.0", # Length of working week for main job
"f.22605.0.0", # Work hours per week
"f.757.0.0", # Time employed in main current job
"f.6138.0.0", # Qualifications
"f.21002.0.0","f.50.0.0","f.21001.0.0", # Weight, heights, BMI
"f.34.0.0", # Year of birth
"f.21003.0.0", # Age at recruitment
"f.20160.0.0", # Ever smoking status
"f.2887.0.0", #Number of cigarettes previously smoked daily
"f.3456.0.0", #Number of cigarette currently smoked daily
"f.1239.0.0", # Current tobacco smoking
"f.22040.0.0", # Summed MET minutes per week for all activity
"f.20117.0.0", # Alcohol drinker status
"f.1558.0.0", # Alcohol intake frequency
"f.1180.0.0", # Chronotype
"f.1160.0.0", # Sleep duration
"f.1200.0.0", # Sleeplessness, insomnia
"f.20517.0.0", # Trouble falling asleep
"f.6142.0.0", # Employment status
"f.6153.0.0", # Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones
"f.6177.0.0", # Medication for cholesterol, blood pressure or diabetes
"f.2976.0.0", "f.2976.1.0", "f.2976.2.0", #Age diabetes diagnosed
"f.2443.0.0", "f.2443.1.0", "f.2443.2.0", #Diabetes diagnosed by doctor
"f.2453.0.0", "f.2453.1.0", "f.2453.2.0" #Cancer diagnosed by doctor
#"f.2724.0.0","f.2734.0.0","f.2754.0.0", "f.2784.0.0" # menopause, number of live birth, age at first live birth, oral conceptive
nrow = 1000)
selected_variable <- c("f.eid", #Participant identifier
"f.31.0.0", #Sex
"f.21000.0.0", # Ethnic background
"f.22006.0.0", # Genetic ethnic background
"f.189.0.0", # Townsend deprivation index
"f.826.0.0", # Job involve shift work
"f.3426.0.0", # Job involve nightshirt
"f.816.0.0", # Job involves heavy manual or physical work
"f.767.0.0", # Length of working week for main job
"f.22605.0.0", # Work hours per week
"f.757.0.0", # Time employed in main current job
"f.6138.0.0", # Qualifications
"f.21002.0.0","f.50.0.0","f.21001.0.0", # Weight, heights, BMI
"f.34.0.0", # Year of birth
"f.21003.0.0", # Age at recruitment
"f.20160.0.0", # Ever smoking status
"f.2887.0.0", #Number of cigarettes previously smoked daily
"f.3456.0.0", #Number of cigarette currently smoked daily
"f.1239.0.0", # Current tobacco smoking
"f.22040.0.0", # Summed MET minutes per week for all activity
"f.20117.0.0", # Alcohol drinker status
"f.1558.0.0", # Alcohol intake frequency
"f.1180.0.0", # Chronotype
"f.1160.0.0", # Sleep duration
"f.1200.0.0", # Sleeplessness, insomnia
"f.20517.0.0", # Trouble falling asleep
"f.6142.0.0", # Employment status
"f.6153.0.0", # Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones
"f.6177.0.0", # Medication for cholesterol, blood pressure or diabetes
"f.2976.0.0", "f.2976.1.0", "f.2976.2.0", #Age diabetes diagnosed
"f.2443.0.0", "f.2443.1.0", "f.2443.2.0", #Diabetes diagnosed by doctor
"f.2453.0.0", "f.2453.1.0", "f.2453.2.0", #Cancer diagnosed by doctor
#"f.2724.0.0","f.2734.0.0","f.2754.0.0", "f.2784.0.0" # menopause, number of live birth, age at first live birth, oral conceptive
nrow = 1000)
dict_tab <- read_csv("dict_tab.csv", show_col_type = F) # data dictionary
selected_tab <- selected_variable %>% as_tibble() %>% left_join (dict_tab, by = c ("value" ="colheaders_raw")) %>% dplyr::select(10,11,22,15)
cbind (" " = 1:nrow(selected_tab), selected_tab) %>% knitr::kable()
selected_variable <- c("f.eid", #Participant identifier
"f.31.0.0", #Sex
"f.21000.0.0", # Ethnic background
"f.22006.0.0", # Genetic ethnic background
"f.189.0.0", # Townsend deprivation index
"f.826.0.0", # Job involve shift work
"f.3426.0.0", # Job involve nightshirt
"f.816.0.0", # Job involves heavy manual or physical work
"f.767.0.0", # Length of working week for main job
"f.22605.0.0", # Work hours per week
"f.757.0.0", # Time employed in main current job
"f.6138.0.0", # Qualifications
"f.21002.0.0","f.50.0.0","f.21001.0.0", # Weight, heights, BMI
"f.34.0.0", # Year of birth
"f.21003.0.0", # Age at recruitment
"f.20160.0.0", # Ever smoking status
"f.2887.0.0", #Number of cigarettes previously smoked daily
"f.3456.0.0", #Number of cigarette currently smoked daily
"f.1239.0.0", # Current tobacco smoking
"f.22040.0.0", # Summed MET minutes per week for all activity
"f.20117.0.0", # Alcohol drinker status
"f.1558.0.0", # Alcohol intake frequency
"f.1180.0.0", # Chronotype
"f.1160.0.0", # Sleep duration
"f.1200.0.0", # Sleeplessness, insomnia
"f.20517.0.0", # Trouble falling asleep
"f.6142.0.0", # Employment status
"f.6153.0.0", # Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones
"f.6177.0.0", # Medication for cholesterol, blood pressure or diabetes
"f.2976.0.0", "f.2976.1.0", "f.2976.2.0", #Age diabetes diagnosed
"f.2443.0.0", "f.2443.1.0", "f.2443.2.0", #Diabetes diagnosed by doctor
"f.2453.0.0", "f.2453.1.0", "f.2453.2.0" #Cancer diagnosed by doctor
#"f.2724.0.0","f.2734.0.0","f.2754.0.0", "f.2784.0.0" # menopause, number of live birth, age at first live birth, oral conceptive
)
dict_tab <- read_csv("dict_tab.csv", show_col_type = F) # data dictionary
selected_tab <- selected_variable %>% as_tibble() %>% left_join (dict_tab, by = c ("value" ="colheaders_raw")) %>% dplyr::select(10,11,22,15)
cbind (" " = 1:nrow(selected_tab), selected_tab) %>% knitr::kable()
```{r setup, echo = FALSE}
library(tidyverse)
"This is a string without a closing quote
double_quote <- "\""
double_quote <- "\""
single_quote <- '\''
print(double_quote)
double_quote <- "\""
single_quote <- '\''
print(double_quote)
print(single_quote)
double_quote <- "\""
single_quote <- '\''
print(double_quote)
print(single_quote)
unlink("Documents/GitHub/R-Group/R4ds chapter 14_cache", recursive = TRUE)
knitr::opts_chunk$set(error = TRUE)
library(tidyverse)
string1 <- "This is a string"
string2 <- 'If I want to include a "quote" inside a string, I use single quote '
"This is a string without a closing quote
+
+
+
knitr::opts_knit$set(root.dir = "/Volumes/ukbiobank/Dat_T")
list.of.packages <- c("ggplot2", "Rcpp", "data.table", "tidyverse", "labelled","gtsummary","writexl","flextable", "tinytex", "crosstable", "RColorBrewer")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
invisible(lapply(list.of.packages, library, character.only=TRUE))
selected_variable <- c("f.eid", #Participant identifier
"f.31.0.0", #Sex
"f.21000.0.0", # Ethnic background
"f.22006.0.0", # Genetic ethnic background
"f.189.0.0", # Townsend deprivation index
"f.826.0.0", # Job involve shift work
"f.3426.0.0", # Job involve nightshirt
"f.816.0.0", # Job involves heavy manual or physical work
"f.767.0.0", # Length of working week for main job
"f.22605.0.0", # Work hours per week
"f.757.0.0", # Time employed in main current job
"f.6138.0.0", # Qualifications
"f.21002.0.0","f.50.0.0","f.21001.0.0", # Weight, heights, BMI
"f.34.0.0", # Year of birth
"f.21003.0.0", # Age at recruitment
"f.20160.0.0", # Ever smoking status
"f.2887.0.0", #Number of cigarettes previously smoked daily
"f.3456.0.0", #Number of cigarette currently smoked daily
"f.1239.0.0", # Current tobacco smoking
"f.22040.0.0", # Summed MET minutes per week for all activity
"f.20117.0.0", # Alcohol drinker status
"f.1558.0.0", # Alcohol intake frequency
"f.1180.0.0", # Chronotype
"f.1160.0.0", # Sleep duration
"f.1200.0.0", # Sleeplessness, insomnia
"f.20517.0.0", # Trouble falling asleep
"f.6142.0.0", # Employment status
"f.6153.0.0", # Medication for cholesterol, blood pressure, diabetes, or take exogenous hormones
"f.6177.0.0", # Medication for cholesterol, blood pressure or diabetes
"f.2976.0.0", "f.2976.1.0", "f.2976.2.0", #Age diabetes diagnosed
"f.2443.0.0", "f.2443.1.0", "f.2443.2.0", #Diabetes diagnosed by doctor
"f.2453.0.0", "f.2453.1.0", "f.2453.2.0" #Cancer diagnosed by doctor
#"f.2724.0.0","f.2734.0.0","f.2754.0.0", "f.2784.0.0" # menopause, number of live birth, age at first live birth, oral conceptive
)
dict_tab <- read_csv("dict_tab.csv", show_col_type = F) # data dictionary
selected_tab <- selected_variable %>% as_tibble() %>% left_join (dict_tab, by = c ("value" ="colheaders_raw")) %>% dplyr::select(10,11,22,15)
cbind (" " = 1:nrow(selected_tab), selected_tab) %>% knitr::kable()
bd <- data.table::fread("../../../../Users/dat/Documents/UKB/ukb35288.tab", header=TRUE, sep="\t"#,nrow = 10000
, select = selected_variable) %>% as_tibble()
withdrawal <- scan("withdraw48576_144.txt")
# Label for only employment question 6142
lvl.100295 <- c(-7,-3,1,2,3,4,5,6,7)
lbl.100295 <- c("None of the above","Prefer not to answer","In paid employment or self-employed","Retired","Looking after home and/or family","Unable to work because of sickness or disability","Unemployed","Doing unpaid or voluntary work","Full or part-time student")
bd$f.6142.0.0 <- ordered(bd$f.6142.0.0, levels=lvl.100295, labels=lbl.100295)
ggplot(bd, aes(x = f.6142.0.0)) +
geom_bar() +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,300000) +
theme_minimal () +
labs(title = "Employment status", x = "Which of the following describes your current situation?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20))
bd <- bd %>% dplyr::filter(f.6142.0.0 == "In paid employment or self-employed") %>% #Subset of paid and self-employed
dplyr::filter(!f.eid %in% withdrawal)  #Filter out participant withdraw from study
nrow(bd)
ll <- parse(file = "Code/ukb35288.r") #Run source code for naming variable
for (i in seq_along(ll)) {
try(eval(ll[[i]]), silent = TRUE)
}
dict_tab <- read_csv("dict_tab.csv") # data dictionary
label <- dict_tab %>% select (3,2) %>% dplyr::filter(colheaders_raw %in% colnames (bd)) %>% deframe ()
bd <-  bd %>% set_variable_labels(!!!label) #label every column
rm(list = setdiff(ls(), c("bd", "withdrawal","dict_tab")))  # Remove redundant values
bd <- bd %>% mutate(night_shift = case_when(f.826.0.0 == "Never/rarely"~ 0,
f.3426.0.0 == "Never/rarely"~ 1,
f.3426.0.0 == "Sometimes" ~ 2,
f.3426.0.0 == "Usually" ~ 3,
f.3426.0.0 == "Always" ~ 4),
f.22006.0.0 = case_when(f.22006.0.0 == "Caucasian" ~ "Caucasian",
is.na(f.22006.0.0) ~ "Non-caucasian")
)
bd$night_shift <- ordered(bd$night_shift, labels=c("Day worker","Never/rarely","Sometimes","Usually","Always"))
# Drop do not know and prefer not to answer
noinfotona <- c("f.21000.0.0","f.1200.0.0","f.1239.0.0","f.20117.0.0", "f.816.0.0", "f.6138.0.0", "f.20517.0.0", "f.6153.0.0", "f.6177.0.0", "f.1558.0.0")
for (i in noinfotona) {
bd[,i] <- droplevels(bd[,i], exclude = c("Prefer not to answer", "Do not know"))
}
table(bd$f.826.0.0, bd$f.3426.0.0, useNA = "always") %>% knitr::kable()
options(scipen = 10000)
ggplot(bd, aes(x = night_shift, fill = night_shift)) +
geom_bar(colour = "grey") +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,300000) +
theme_minimal () +
labs(title = "Participants per categories of night shift", x = "Night shift category") +
scale_fill_brewer(palette = "YlOrRd")
options(scipen = 10000)
mypalette_1 <- brewer.pal(8,"YlOrBr")
ggplot(bd, aes(x = f.1180.0.0, fill = f.1180.0.0)) +
geom_bar(colour = "grey") +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,100000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20)) +
guides(fill = F) +
scale_fill_manual(values = c("#D3D3D3","#E5E5E5","#FFE5B4", "#FFFFC2", "#C5D9FF", "#5B7E91", "#D3D3D3"))
bd <- mutate (bd, chronotype = case_when (f.1180.0.0 %in% c("Definitely a 'morning' person","More a 'morning' than 'evening' person") ~ "Morning type",
f.1180.0.0 %in% c("Definitely an 'evening' person","More an 'evening' than a 'morning' person") ~ "Evening type",
f.1180.0.0 == "Prefer not to answer" ~ NA,
f.1180.0.0 == "Do not know" ~ "Do not know")
)
ggplot(bd, aes(x = chronotype, fill = chronotype)) +
geom_bar() +
geom_text(aes(label = ..count..), stat = 'count', vjust = -1) +
ylim (0,200000) +
theme_minimal () +
labs(x = "Do you consider yourself to be?") +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust =1)) +
scale_x_discrete(labels = function(x) str_wrap(x, width= 20))+
scale_fill_manual(values = c("#E5E5E5","#5B7E91","#FFE5B4", "#D3D3D3")) +
guides(fill = F)
frequency_tab <- bd %>% select(c(night_shift, f.31.0.0, f.21003.0.0, f.21000.0.0, f.22006.0.0, f.816.0.0, f.767.0.0, f.22605.0.0, f.757.0.0, f.6138.0.0, f.21002.0.0, f.50.0.0, f.21001.0.0, f.189.0.0, f.20160.0.0, f.1239.0.0, f.2887.0.0, f.3456.0.0 , f.22040.0.0, f.20117.0.0, f.1558.0.0, f.1180.0.0, chronotype, f.1200.0.0, f.20517.0.0, f.1160.0.0, f.6153.0.0, f.6177.0.0)) %>%
tbl_summary(by = night_shift,
statistic = list(all_continuous() ~ "{mean} ({sd})", all_categorical() ~ "{n} ({p}%)"),
digits = list(all_continuous() ~ c(2,2), all_categorical() ~ c (0,2)),
label = c (f.31.0.0 ~ "Sex",
f.21003.0.0 ~ "Age when attended assessment centre (Year)",
f.21000.0.0 ~ "Ethnic background",
f.22006.0.0 ~ "Genetic ethnicity",
f.816.0.0 ~ "Job involves heavy manual",
f.767.0.0 ~ "Length of working week for main job",
f.22605.0.0 ~ "Work hour per week",
f.757.0.0 ~ "Time employed in main current job",
f.6138.0.0 ~ "Qualification",
f.21002.0.0 ~ "Weight (kg)",
f.50.0.0 ~ "Height (cm)",
f.21001.0.0 ~ "BMI (kg/m2)",
f.189.0.0 ~ "Townsend Index",
f.20160.0.0 ~ "Ever smoked",
f.1239.0.0 ~ "Current tobacco smoking",
f.2887.0.0 ~ "Number of cigarettes previously smoked daily",
f.3456.0.0 ~ "Number of cigarette currently smoked daily",
f.22040.0.0 ~ "Physical activity (summed MET/week)",
f.20117.0.0 ~ "Alcohol drinker",
f.1558.0.0 ~ "Alcohol intake frequency",
f.1180.0.0 ~ "Chronotype",
chronotype ~ "Chronotype - 3 levels",
f.1200.0.0 ~ "Insomnia",
f.20517.0.0 ~ "Trouble falling asleep",
f.1160.0.0 ~ "Sleep duration",
f.6153.0.0 ~ "Medication usage",
f.6177.0.0 ~ "Medication for cholesterol, bp, diabetes")
#,missing = "no"
) %>%
add_n() %>%
add_p(test  = list (all_categorical() ~ "chisq.test")) %>%
bold_labels() %>%
add_overall()
frequency_tab
frequency_tab %>% as_tibble() %>% writexl::write_xlsx(path = "Results/frequency_tab.xlsx")
frequency_tab %>% as_flex_table() %>% flextable::save_as_docx(path = "Results/frequency_tab.docx")
View(bd)
reticulate::repl_python()
library(tidyverse)
reticulate::repl_python()
print("Hello world")
